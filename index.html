<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Building Audit Form</title>
  <style>
    
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f4f4;
      color: #555;
    }
    /* Year Picker Styles */
    .year-picker {
      cursor: pointer;
      background-color: #fff;
    }
    
    .ui-datepicker {
      z-index: 9999 !important;
      padding: 0.5em;
    }
    
    .ui-datepicker-year {
      width: 100%;
      padding: 0.2em;
      margin: 0;
      font-size: 1em;
    }
    
    .ui-datepicker .ui-datepicker-buttonpane {
      display: none;
    }
    
    .ui-datepicker-title select {
      font-size: 1em;
      margin: 1px 0;
    }
    
    .ui-datepicker-title {
      margin: 0 2.3em;
      line-height: 1.8em;
      text-align: center;
    }
    
    .ui-datepicker-header {
      padding: 0.2em 0;
    }
    
    .form-group, .form-control, td {
      overflow: visible !important;
      position: relative;
    }


    .chiller-col {
    min-width: 200px;
    width: 200px;
  }
  .chiller-col .form-control,
  .chiller-col .input-group {
    width: 100% !important;
  }
  .chiller-col input[type="number"],
  .chiller-col input[type="text"],
  .chiller-col select {
    width: 100% !important;
    min-width: 180px;
  }
  .chiller-col .input-group .form-control {
    flex: 1 1 auto;
    min-width: 0;
  }
  .chiller-col .input-group-text {
    min-width: 40px;
  }
  .chiller-col .d-flex {
    display: flex !important;
    gap: 8px;
  }
  .chiller-col .d-flex > * {
    flex: 1;
    min-width: 0;
  }
    .container {
      display: flex;
      justify-content: space-between;
    }
    .header {
      background-color: #a85c42;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
    }

    .header img {
      height: 60px;
      width: auto;
    }

    .title {
      font-size: 1.8rem;
      font-weight: bold;
      text-align: center;
      flex-grow: 1;
    }
    
    /* Expand/Collapse All Buttons */
    .expand-collapse-controls {
      display: flex;
      justify-content: flex-start;
      gap: 10px;
      margin:  10px 0 10px;
    }
    
    .expand-collapse-controls button {
      padding: 8px 15px;
      font-size: 0.9rem;
      background-color: #a85c42;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .expand-collapse-controls button:hover {
      background-color: #8b4c34;
    }

    h2 {
      background-color: #a85c42;
      color: white;
      padding: 10px 15px;
      margin: 20px 10px 0 10px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 1.2rem;
      font-weight: normal;
    }

    .section {
      margin: 0 10px 20px 10px;
      padding: 20px;
      background: #fff;
      border: 1px solid #ddd;
      display: none;
      border-radius: 0 0 4px 4px;
    }

    .form-row {
      display: flex;
      flex-wrap: nowrap;
      align-items: center;
      margin-bottom: 15px;
      padding: 10px;
      border-bottom: 1px solid #eee;
      overflow-x: auto;
    }

    .form-row:last-child {
      border-bottom: none;
    }

    .form-label {
      flex: 0 0 150px;
      font-weight: bold;
      color: #555;
      margin-right: 15px;
      white-space: nowrap;
    }

    .form-label.required:after {
      content: " *";
      color: #e32;
      font-weight: bold;
    }

    .form-inputs {
      display: flex;
      flex-wrap: wrap; /* Changed from nowrap to wrap */
      align-items: center;
      gap: 15px;
      overflow-x: visible; /* Changed from auto to visible */
    }
    
    /* New styles for multi-row form inputs */
    .multi-row-section .form-inputs {
      flex-wrap: wrap;
      overflow-x: visible;
      row-gap: 15px;
    }
    
    .multi-row-section .input-group {
      margin-bottom: 5px;
    }

    .input-group {
      display: flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
    }

    .input-group input[type="text"],
    .input-group input[type="number"] {
      width: 80px;
    }

    .input-group select {
      width: auto;
    }

    input, select, textarea {
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #a85c42;
      outline: none;
    }

    /* Checkbox styling */
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: nowrap;
    }

    .checkbox-option {
      display: flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
    }

    .checkbox-option input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    /* Radio buttons styling */
    .radio-group {
      display: flex;
      gap: 15px;
      flex-wrap: nowrap;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
    }

    .radio-option input[type="radio"] {
      width: auto;
      margin: 0;
    }

    /* Unit selector */
    .unit-selector {
      display: flex;
      align-items: center;
      border: 1px solid #ccc;
      border-radius: 4px;
      overflow: hidden;
    }

    .unit-selector select {
      border: none;
      border-left: 1px solid #ccc;
      border-radius: 0;
      padding: 8px 5px;
      background-color: #f9f9f9;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
       gap: 10px;
       margin:  10px 0 10px;
    }

    .form-actions button {
      padding: 8px 15px;
      font-size: 1rem;
      background-color: #a85c42;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .form-actions button:hover {
      background-color: #8b4c34;
    }

    .field-hint {
      font-size: 12px;
      color: #777;
      margin-left: 5px;
    }

    /* Category and Subcategory Styling */
    .category-header {
      background-color: #c17a62;
      color: white;
      padding: 8px 15px;
      margin: 15px 0 10px 0;
      font-size: 1.1rem;
      font-weight: bold;
      border-radius: 4px;
      cursor: pointer;
      position: relative;
    }
    
    .category-header:after {
      content: '▼';
      position: absolute;
      right: 15px;
      transition: transform 0.3s;
    }
    
    .category-header.collapsed:after {
      transform: rotate(-90deg);
    }
    
    .category-content {
      overflow: hidden;
      transition: max-height 0.3s ease-out;
      max-height: 2000px; /* Arbitrary large value */
    }
    
    .category-content.collapsed {
      max-height: 0;
    }

    .subcategory {
      margin: 5px 0;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
    }

    .subcategory-header {
      background-color: #f0d9d2;
      color: #8b4c34;
      padding: 8px 15px;
      font-weight: bold;
      cursor: pointer;
      position: relative;
      transition: background-color 0.2s;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .subcategory-header:hover {
      background-color: #e8c9be;
    }
    
    .subcategory-header:after {
      content: '▼';
      position: absolute;
      right: 15px;
      transition: transform 0.3s;
    }
    
    .subcategory-header.collapsed:after {
      transform: rotate(-90deg);
    }
    
    .subcategory-content {
      overflow: hidden;
      transition: max-height 0.3s ease-out;
      max-height: 500px; /* Arbitrary large value */
    }
    
    .subcategory-content.collapsed {
      max-height: 0;
    }
    
    /* Tree structure styling */
    .tree-level-1 {
      margin-left: 0;
    }
    
    .tree-level-2 {
      margin-left: 20px;
    }
    
    .tree-level-3 {
      margin-left: 40px;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .form-label {
        margin-bottom: 10px;
      }
      
      .form-inputs {
        width: 100%;
        overflow-x: auto;
      }
    }
    
    /* Add table styles */
    .input-table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }
    .input-table:not(:first-child) {
      display: none; /* Hide all tables by default except the first one */
    }
    .subcategory-content {
      display: none; /* Hide content by default */
    }
    .subcategory-header input[type="checkbox"]:checked ~ .subcategory-content {
      display: block; /* Show content when checkbox is checked */
    }
    .subcategory-header input[type="checkbox"]:checked ~ .subcategory-content .input-table {
      display: table; /* Show table when parent content is shown */
    }
    .input-table th, .input-table td {
      padding: 8px;
      text-align: left;
      border: 1px solid #ddd;
    }
    .action-buttons {
      white-space: nowrap;
    }
    .remove-row-btn {
      background: none;
      border: none;
      color: #f44336;
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
      margin: 0 3px;
    }
    .add-row-btn {
      display: none; /* Hide the add row buttons */
    }
    
    /* Chiller table styles */
    .table-responsive {
      max-height: 70vh;
      overflow-x: auto;
      border: 1px solid #dee2e6;
      margin: 20px 0;
    }
    .fixed-col {
      position: sticky;
      left: 0;
      background: white;
      z-index: 2;
      min-width: 250px;
      white-space: nowrap;
    }
    .action-col {
      position: sticky;
      right: 0;
      background: white;
      z-index: 2;
      min-width: 100px;
    }
    .chiller-col {
      min-width: 180px;
    }
    .table thead th {
      position: sticky;
      top: 0;
      background: #f8f9fa;
      z-index: 3;
    }
    .form-control-sm {
      padding: 0.25rem 0.5rem;
      font-size: 0.875rem;
    }

    /* Chiller Column Styles - Fixed Width */
    .chiller-col {
      width: 180px !important;
      min-width: 180px !important;
      max-width: 180px !important;
      padding: 0.25rem !important;
    }

    /* Force all form controls to be exactly the same size */
    #chillerTableBody td:not(.fixed-col):not(.action-col) {
      width: 180px !important;
      min-width: 180px !important;
      max-width: 180px !important;
      padding: 0.25rem !important;
    }

    /* Reset all inputs and selects */
    #chillerTableBody input:not([type=button]):not([type=checkbox]),
    #chillerTableBody select,
    #chillerTableBody .form-control,
    #chillerTableBody .form-select {
      width: 100% !important;
      min-width: 100% !important;
      max-width: 100% !important;
      height: 31px !important;
      padding: 0.25rem 0.5rem !important;
      box-sizing: border-box !important;
      font-size: 0.875rem !important;
      margin: 0 !important;
      border: 1px solid #ced4da !important;
      border-radius: 0.2rem !important;
    }

    /* Input groups */
    #chillerTableBody .input-group {
      width: 100% !important;
      min-width: 100% !important;
      max-width: 100% !important;
      display: flex !important;
    }

    #chillerTableBody .input-group .form-control {
      flex: 1 1 auto;
      width: 1% !important;
      min-width: 0 !important;
    }

    #chillerTableBody .input-group-text {
      width: 40px !important;
      min-width: 40px !important;
      padding: 0.25rem;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Flex container for special layouts */
    #chillerTableBody .d-flex {
      display: flex !important;
      gap: 4px;
      width: 100% !important;
    }
  </style>
</head>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<body>

  <div class="header">
    <img src="EDSlogo.png" alt="Left Logo Placeholder">
    <div class="title">Building Audit Form</div>
    <img src="HCL-Technologies-Symbol.png" alt="Right Logo Placeholder">
  </div>

<!-- Add expand/collapse all buttons -->
<div class = "container">
<div class="expand-collapse-controls">
  <button type="button" id="expandAllBtn">Expand All</button>
  <button type="button" id="collapseAllBtn">Collapse All</button>
</div>
<div class="form-actions">
  <button type="button" onclick="saveForm()">Save</button>
  <button type="submit" onclick="submitForm()">Submit</button>
</div>
</div>

<h2 onclick="toggleSection('buildingInfo')">Building Information</h2>
<div id="buildingInfo" class="section">

  <div class="category-header">General Information</div>
  <div class="category-content">
  <div class="form-row">
    <!-- <div class="form-label"></div> -->
    <div class="form-inputs">
      <div class = "input-group">
        <span>Project Name:</span>
        <input type="text" required style="width: 150px;" name="project_name">
        </div>
        <div class = "input-group">
          <span>Brand:</span>
          <select name="brand">
            <option value="">Select Brand</option>
            <option value="Taj">Taj</option>
            <option value="SeleQtions">SeleQtions</option>
            <option value="Vivanta">Vivanta</option>
            <option value="Gateway">Gateway</option>
            <option value="Ginger">Ginger</option>
          </select>
        </div>
          <div class = "input-group">
            <span>Country:</span>
            <select required id="stateDropdown" name="country">
              <option value="">Please select</option>
              <option value="India">India</option>
            </select>
          </div>
      <div class="input-group">
        <span>State:</span>
        <select required id="stateDropdown" name="state">
          <option value="">Please select</option>
          <option value="AP">Andhra Pradesh</option>
          <option value="AR">Arunachal Pradesh</option>
          <option value="AS">Assam</option>
          <option value="BR">Bihar</option>
          <option value="CG">Chhattisgarh</option>
          <option value="GA">Goa</option>
          <option value="GJ">Gujarat</option>
          <option value="HR">Haryana</option>
          <option value="HP">Himachal Pradesh</option>
          <option value="JH">Jharkhand</option>
          <option value="KA">Karnataka</option>
          <option value="KL">Kerala</option>
          <option value="MP">Madhya Pradesh</option>
          <option value="MH">Maharashtra</option>
          <option value="MN">Manipur</option>
          <option value="ML">Meghalaya</option>
          <option value="MZ">Mizoram</option>
          <option value="NL">Nagaland</option>
          <option value="OR">Odisha</option>
          <option value="PB">Punjab</option>
          <option value="RJ">Rajasthan</option>
          <option value="SK">Sikkim</option>
          <option value="TN">Tamil Nadu</option>
          <option value="TG">Telangana</option>
          <option value="TR">Tripura</option>
          <option value="UP">Uttar Pradesh</option>
          <option value="UK">Uttarakhand</option>
          <option value="WB">West Bengal</option>
          <option value="DL">Delhi</option>
        </select>
      </div>
      <div class="input-group">
        <span>City:</span>
        <select required id="cityDropdown" name="city">
          <option value="">Please select a state first</option>
        </select>
      </div>
      <!-- <div class="input-group">
        <span>Area:</span>
        <input type="text" style="width: 80px;">
        <select>
          <option value="sqm">sq.m</option>
          <option value="sqft">sq.ft</option>
          <option value="acre">acre</option>
        </select>
      </div> -->
      <div class="input-group">
        <span>Years of Construction:</span>
        <input type="date" required style="width: 118px;" name="construction_date">
      </div>
      <div class="input-group">
        <span>Last Renovation:</span>
        <input type="date" style="width: 118px;" name="renovation_date">
      </div>
    <!-- </div> -->
  <!-- </div> -->
  
  <!-- <div class="form-row"> -->
    <!-- <div class="form-label "></div> -->
    <!-- <div class="form-inputs"> -->
      <div class="input-group">
        <span>No. of Floors Above grade:</span>
        <input type="number" min="0" max="99" required style="width: 60px;" name="floors_above_grade">
      </div>
      <div class="input-group">
        <span>No.of Floors Below Grade:</span>
        <input type="number" min="0" max="9" style="width: 60px;" name="floors_below_grade">
      </div>
      <div class="input-group">
        <span>Ownership:</span>
        <select required name="ownership">
          <option value="">Please select</option>
          <option>Owned</option>
          <option>Leased</option>
          <option>Managed</option>
        </select>
      <!-- </div> -->
    </div>
    <div class="input-group">
      <span>Certifications/Compliance</span>
      <select required name="certifications">
        <option value="">Please select</option>
        <option>LEED</option>
        <option>IGBC</option>
        <option>GRIHA</option>
      </select>
    <!-- </div> -->
  </div>
  <div class="input-group">
    <span>Last Audit Conducted:</span>
    <input type="date" required style="width: 118px;" name="last_audit_date">
   
  </div>
  <!-- </div> -->
</div>
</div>
</div>

<!-- <h2 onclick="toggleSection('siteArea')">Site & Area</h2> -->
 
<!-- <div id="siteArea" class="section"> -->
  <div class="category-header">Site & Area</div>
  <div class="category-content">
  <div class="form-row">
    <!-- <div class="form-label required">Site Details</div> -->
    <div class="form-inputs">
      <div class="input-group">
        <span>Site Area:</span>
        <input type="number" min="0" required style="width: 80px;">
        <select>
          <option value="sqm">sq.m</option>
          <option value="sqft">sq.ft</option>
          <option value="acre">acre</option>
        </select>
      </div>
      <div class="input-group">
        <span>Built-up Area:</span>
        <input type="number" min="0" required style="width: 80px;">
        <select>
          <option value="sqm">sq.m</option>
          <option value="sqft">sq.ft</option>
        </select>
      </div>
      <div class="input-group">
        <span>Basement Parking:</span>
        <input type="number" min="0" style="width: 80px;">
        <select>
          <option value="sqm">sq.m</option>
          <option value="sqft">sq.ft</option>
        </select>
      </div>
      <div class="input-group">
        <span>Ground Coverage:</span>
        <input type="number" min="0" maxlength="3" style="width: 60px;">
        <span>%</span>
      </div>
      <div class="input-group">
        <span>Open Area:</span>
        <input type="number" min="0" style="width: 80px;">
        <select>
          <option value="sqm">sq.m</option>
          <option value="sqft">sq.ft</option>
        </select>
      </div>
    </div>
  </div>
</div>

<!-- <h2 onclick="toggleSection('occupancy')">Occupancy</h2>
<div id="occupancy" class="section"> -->
  <div class="category-header">Occupancy</div>
  <div class="category-content">
  <div class="form-row">
    <!-- <div class="form-label required">Occupancy Details</div> -->
    <div class="form-inputs">
      <div class="input-group">
        <span>Number of Keys/Rooms:</span>
        <input type="number" required style="width: 60px;">
      </div>
      <div class="input-group">
        <span>Peak Occupancy Rate:</span>
        <input type="number" min="0" max="100" style="width: 60px;">
        <span>%</span>
      </div>
      <div class="input-group">
        <span>Average Guests/Day:</span>
        <input type="number" style="width: 60px;">
      </div>
      <div class="input-group">
        <span>Total Staff:</span>
        <input type="number" style="width: 60px;">
      </div>
    </div>
  </div>
</div>
</div>
</div>

<h2 onclick="toggleSection('energySystems')">Energy Systems</h2>
<div id="energySystems" class="section">
  <div class="form-row">
    <!-- <div class="form-label required">Energy Details</div> -->
    <div class="form-inputs">
      <div class="input-group">
        <span>Connected Load:</span>
        <input type="number" required style="width: 80px;">
        <span>kW</span>
      </div>
      <div class="input-group">
        <span>Contract Demand:</span>
        <input type="number" style="width: 80px;">
        <span>kVA</span>
      </div>
      <div class="input-group">
        <span>Backup Power:</span>
        <input type="number" style="width: 80px;">
        <span>kVA</span>
      </div>
      <div class="input-group">
        <span>Renewable Energy:</span>
        <input type="number" style="width: 80px;">
        <span>kWp</span>
      </div>
      <div class="input-group">
        <span>Type:</span>
        <select>
          <option value="">Select type</option>
          <option value="solar">Solar</option>
          <option value="wind">Wind</option>
          <option value="biomass">Biomass</option>
          <option value="other">Other</option>
        </select>
      </div>
    </div>
  </div>
</div>

<h2 onclick="toggleSection('waterSystems')">Water Systems</h2>
<div id="waterSystems" class="section">
  <div class="form-row">
    <div class="form-label required">Water Source</div>
    <div class="form-inputs">
      <div class="checkbox-group">
        <label class="checkbox-option">
          <input type="checkbox" name="waterSource" value="Municipal"> Municipal
        </label>
        <label class="checkbox-option">
          <input type="checkbox" name="waterSource" value="Borewell"> Borewell
        </label>
        <label class="checkbox-option">
          <input type="checkbox" name="waterSource" value="Tanker"> Tanker
        </label>
        <label class="checkbox-option">
          <input type="checkbox" name="waterSource" value="Other"> Other
        </label>
      </div>
    </div>
  </div>
  
  <div class="form-row">
    <div class="form-label required">Water Usage</div>
    <div class="form-inputs">
      <div class="input-group">
        <span>Daily Water Demand:</span>
        <input type="number" required style="width: 80px;" name="daily_water_demand">
        <span>KLD</span>
      </div>
      <div class="input-group">
        <span>STP Capacity:</span>
        <input type="number" style="width: 80px;" name="stp_capacity">
        <span>KLD</span>
      </div>
      <div class="input-group">
        <span>Treated Water Reuse:</span>
        <input type="number" min="0" max="100" style="width: 60px;" name="treated_water_reuse">
        <span>%</span>
      </div>
      <div class="input-group">
        <span>Purpose:</span>
        <select>
          <option value="">Select purpose</option>
          <option value="flushing">Flushing</option>
          <option value="gardening">Gardening</option>
          <option value="cooling">Cooling</option>
          <option value="multiple">Multiple</option>
        </select>
      </div>
    </div>
  </div>
  
  <div class="form-row">
    <div class="form-label">Water Features</div>
    <div class="form-inputs">
      <div class="input-group">
        <span>Water-saving Fixtures:</span>
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="waterFixtures" value="Yes"> Yes
          </label>
          <label class="radio-option">
            <input type="radio" name="waterFixtures" value="No"> No
          </label>
        </div>
      </div>
      <div class="input-group">
        <span>Rainwater Harvesting:</span>
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="rainwaterHarvesting" value="Yes"> Yes
          </label>
          <label class="radio-option">
            <input type="radio" name="rainwaterHarvesting" value="No"> No
          </label>
        </div>
      </div>
    </div>
  </div>
</div>

<h2 onclick="toggleSection('wasteManagement')">Waste Management</h2>
<div id="wasteManagement" class="section">
  <div class="form-row">
    <!-- <div class="form-label required">Waste Details</div> -->
    <div class="form-inputs">
      <div class="input-group">
        <span>Total Waste Generation:</span>
        <input type="text" required style="width: 80px;">
        <span>kg/day</span>
      </div>
      <div class="input-group">
        <span>Segregation at Source:</span>
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="segregation" value="Yes"> Yes
          </label>
          <label class="radio-option">
            <input type="radio" name="segregation" value="No"> No
          </label>
        </div>
      </div>
      <div class="input-group">
        <span>Composting Facility:</span>
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="composting" value="Yes"> Yes
          </label>
          <label class="radio-option">
            <input type="radio" name="composting" value="No"> No
          </label>
        </div>
      </div>
      <div class="input-group">
        <span>Composting Capacity:</span>
        <input type="text" style="width: 80px;">
        <span>kg/day</span>
      </div>
      <div class="input-group">
        <span>Waste Collection Agency:</span>
        <input type="text" style="width: 120px;">
      </div>
    </div>
  </div>
</div>

<h2 onclick="toggleSection('spaceInfo')">Space Information</h2>
<div id="spaceInfo" class="section">
  <!-- Meeting and Event Spaces Category -->
  <div class="category-header">Meeting and Event Spaces</div>
  <div class="category-content">
    
    <div class="subcategory tree-level-2">
      
      <div class="subcategory-header">
        <input type="checkbox" id="banquetCheck"> 
        Banquet Halls
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Area</th>
              <th>Unit</th>
              <th>Maximum Capacity (people)</th>
              <th>No. of Events/Year</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="banquetTableBody">
            <tr>
              <td><input type="number" name="banquet_area[]" style="width: 80px;"></td>
              <td>
                <select name="banquet_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td><input type="number" name="banquet_capacity[]" style="width: 60px;"></td>
              <td><input type="number" name="banquet_events[]" style="width: 60px;"></td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('banquetTableBody', 'banquet')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="outdoorLawnCheck"> 
        Outdoor event Lawns
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Max occupancy</th>
              <th>Area</th>
              <th>Unit</th>
              <th>No. of Events/month</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="outdoorLawnTableBody">
            <tr>
              <td><input type="number" name="outdoor_lawn_occupancy[]" style="width: 60px;"></td>
              <td><input type="number" name="outdoor_lawn_area[]" style="width: 80px;"></td>
              <td>
                <select name="outdoor_lawn_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td><input type="number" name="outdoor_lawn_events[]" style="width: 60px;"></td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('outdoorLawnTableBody', 'outdoorLawn')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="conferenceCheck"> 
        Conference Rooms/Boardrooms
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Seating Capacity</th>
              <th>Area</th>
              <th>Unit</th>
              <th>Usage hours/month</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="conferenceTableBody">
            <tr>
              <td><input type="number" name="conference_capacity[]" style="width: 60px;"></td>
              <td><input type="number" name="conference_area[]" style="width: 80px;"></td>
              <td>
                <select name="conference_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td><input type="number" name="conference_hours[]" style="width: 80px;"></td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('conferenceTableBody', 'conference')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="businessCentreCheck"> 
        Business Centre
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>No. of workstations</th>
              <th>Usage hours/day</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="businessCentreTableBody">
            <tr>
              <td><input type="number" name="business_centre_workstations[]" style="width: 60px;"></td>
              <td><input type="number" name="business_centre_hours[]" style="width: 60px;"></td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('businessCentreTableBody', 'businessCentre')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- Food and Beverage Outlets Category -->
  <div class="category-header">Food and Beverage Outlets</div>
  <div class="category-content">
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="restaurantCheck"> 
        All Day Dining Restaurants
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>No. of seats</th>
              <th>Avg. daily covers (meals served/day)</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="restaurantTableBody">
            <tr>
              <td><input type="number" name="restaurant_seats[]" style="width: 60px;"></td>
              <td><input type="number" name="restaurant_covers[]" style="width: 60px;"></td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('restaurantTableBody', 'restaurant')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="specialityRestaurantCheck"> 
        Speciality Restaurants
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>No. of seats</th>
              <th>Avg. daily covers (meals served/day)</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="specialityRestaurantTableBody">
            <tr>
              <td><input type="number" name="speciality_restaurant_seats[]" style="width: 60px;"></td>
              <td><input type="number" name="speciality_restaurant_covers[]" style="width: 60px;"></td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('specialityRestaurantTableBody', 'specialityRestaurant')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="cafeCheck"> 
        Cafe/Coffee Shop
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>No. of seats</th>
              <th>Operating Hours</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="cafeTableBody">
            <tr>
              <td><input type="number" name="cafe_seats[]" style="width: 60px;"></td>
              <td><input type="text" name="cafe_hours[]" style="width: 100px;"></td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('cafeTableBody', 'cafe')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="kitchenCheck"> 
        Kitchen
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Area</th>
              <th>Unit</th>
              <th>No. of meals prepared per day</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="kitchenTableBody">
            <tr>
              <td><input type="number" name="kitchen_area[]" style="width: 80px;"></td>
              <td>
                <select name="kitchen_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td><input type="number" name="kitchen_meals[]" style="width: 60px;"></td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('kitchenTableBody', 'kitchen')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="staffCafetariaCheck"> 
        Staff Cafetaria
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Area</th>
              <th>Unit</th>
              <th>No. of meals prepared per day</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="staffCafetariaTableBody">
            <tr>
              <td><input type="number" name="staff_cafetaria_area[]" style="width: 80px;"></td>
              <td>
                <select name="staff_cafetaria_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td><input type="number" name="staff_cafetaria_meals[]" style="width: 60px;"></td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('staffCafetariaTableBody', 'staffCafetaria')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- Wellness and Recreation Category -->
  <div class="category-header">Wellness and Recreation</div>
  <div class="category-content">
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="spaCheck"> 
        Spa/Massage Rooms
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>No. of Rooms</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="spaTableBody">
            <tr>
              <td><input type="number" name="spa_rooms[]" style="width: 60px;"></td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('spaTableBody', 'spa')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="salonCheck"> 
        Salon
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Area</th>
              <th>Unit</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="salonTableBody">
            <tr>
              <td><input type="number" name="salon_area[]" style="width: 80px;"></td>
              <td>
                <select name="salon_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('salonTableBody', 'salon')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="gymCheck"> 
        Fitness center/gym
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Area</th>
              <th>Unit</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="gymTableBody">
            <tr>
              <td><input type="number" name="gym_area[]" style="width: 80px;"></td>
              <td>
                <select name="gym_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('gymTableBody', 'gym')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="multipurposeCheck"> 
        Multipurpose Space
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Area</th>
              <th>Unit</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="multipurposeTableBody">
            <tr>
              <td><input type="number" name="multipurpose_area[]" style="width: 80px;"></td>
              <td>
                <select name="multipurpose_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('multipurposeTableBody', 'multipurpose')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="indoorPoolCheck"> 
        Swimming Pool (Indoor)
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Area</th>
              <th>Unit</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="indoorPoolTableBody">
            <tr>
              <td><input type="number" name="indoor_pool_area[]" style="width: 80px;"></td>
              <td>
                <select name="indoor_pool_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('indoorPoolTableBody', 'indoorPool')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="outdoorPoolCheck"> 
        Swimming Pool (Outdoor)
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Area</th>
              <th>Unit</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="outdoorPoolTableBody">
            <tr>
              <td><input type="number" name="outdoor_pool_area[]" style="width: 80px;"></td>
              <td>
                <select name="outdoor_pool_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('outdoorPoolTableBody', 'outdoorPool')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- BOH & Service Areas Category -->
  <div class="category-header">BOH & Service Areas</div>
  <div class="category-content">
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="laundryCheck"> 
        Laundry Rooms
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Area</th>
              <th>Unit</th>
              <th>Kg of laundry/day</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="laundryTableBody">
            <tr>
              <td><input type="number" name="laundry_area[]" style="width: 80px;"></td>
              <td>
                <select name="laundry_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td><input type="number" name="laundry_kg[]" style="width: 80px;"></td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('laundryTableBody', 'laundry')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="subcategory tree-level-2">
      <div class="subcategory-header">
        <input type="checkbox" id="parkingCheck"> 
        Parking Basement
      </div>
      <div class="subcategory-content">
        <table class="input-table">
          <thead>
            <tr>
              <th>Area</th>
              <th>Unit</th>
              <th>No. of Parking</th>
              <th>Lighting Type</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="parkingTableBody">
            <tr>
              <td><input type="number" name="parking_area[]" style="width: 80px;"></td>
              <td>
                <select name="parking_area_unit[]">
                  <option value="sqm">sq.m</option>
                  <option value="sqft">sq.ft</option>
                </select>
              </td>
              <td><input type="number" name="parking_spaces[]" style="width: 60px;"></td>
              <td>
                <select name="parking_lighting[]">
                  <option value="">Select type</option>
                  <option value="led">LED</option>
                  <option value="fluorescent">Fluorescent</option>
                  <option value="other">Other</option>
                </select>
              </td>
              <td class="action-buttons">
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">−</button>
                <button type="button" class="remove-row-btn" onclick="addRow('parkingTableBody', 'parking')" style="color: #4CAF50;">+</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- HVAC Systems Section -->
<h2 onclick="toggleSection('hvacSystems')">HVAC Systems</h2>
<div id="hvacSystems" class="section">
  
  <!-- Chiller Section -->
  <div class="subcategory-header">
    <input type="checkbox" id="chillerCheck"> 
    Chiller Details 
  </div>
  <div class="subcategory-content">
    <div class="table-responsive">
      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <th class="fixed-col">Parameter</th>
            <th class="chiller-col">Chiller 1</th>
            <th class="action-col text-center">
              <button type="button" class="btn btn-sm btn-success me-1" onclick="addChillerColumn()">+</button>
              <button type="button" class="btn btn-sm btn-danger" onclick="removeChillerColumn()">-</button>
            </th>
          </tr>
        </thead>
        <tbody id="chillerTableBody">
          <tr>
            <td class="fixed-col">Type of Chiller (Water/Air)</td>
            <td>
              <select name="chiller1_type" class="form-control form-control-sm">
                <option value="">Select</option>
                <option>Water</option>
                <option>Air</option>
              </select>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Type of Compressor</td>
            <td>
              <select name="chiller1_compressor_type" class="form-control form-control-sm">
                <option value="">Select</option>
                <option>Screw</option>
                <option>Scroll</option>
                <option>Centrifugal</option>
              </select>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Adiabatic Cooling (Air-cooled)</td>
            <td>
              <select name="chiller1_adiabatic_cooling" class="form-control form-control-sm">
                <option value="">Select</option>
                <option>Yes</option>
                <option>No</option>
              </select>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Year of Installation</td>
            <td><input type="text" name="chiller1_installation_year" class="form-control form-control-sm year-picker" readonly></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Number of Chillers</td>
            <td><input type="number" name="chiller1_quantity" class="form-control form-control-sm" min="1"></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Working</td>
            <td><input type="number" name="chiller1_working" class="form-control form-control-sm" min="0" placeholder="Count"></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Standby</td>
            <td><input type="number" name="chiller1_standby" class="form-control form-control-sm" min="0" placeholder="Count"></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Operating Schedule</td>
            <td><input type="text" name="chiller1_schedule" class="form-control form-control-sm" placeholder="e.g. 24/7"></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Avg Running Hrs (Seasonal)</td>
            <td><input type="number" name="chiller1_seasonal_hrs" class="form-control form-control-sm" step="0.1" min="0" placeholder="Hours"></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Avg Running Hrs (Day/Night)</td>
            <td><input type="number" name="chiller1_daynight_hrs" class="form-control form-control-sm" step="0.1" min="0" placeholder="Hours"></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Capacity (TR)</td>
            <td><input type="number" name="chiller1_capacity" class="form-control form-control-sm" step="0.01" min="0"></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Avg Loading %</td>
            <td>
              <div class="input-group input-group-sm">
                <input type="number" name="chiller1_loading_pct" class="form-control" min="0" max="100">
                <span class="input-group-text">%</span>
              </div>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Condenser & Evaporator Approach</td>
            <td><input type="text" name="chiller1_approach" class="form-control form-control-sm" placeholder="e.g. 5°C/3°C"></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Avg Setpoint (Seasonal)</td>
            <td>
              <div class="input-group input-group-sm">
                <input type="number" name="chiller1_seasonal_setpoint" class="form-control" step="0.1">
                <span class="input-group-text">°C</span>
              </div>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Avg Setpoint (Day/Night)</td>
            <td>
              <div class="input-group input-group-sm">
                <input type="number" name="chiller1_daynight_setpoint" class="form-control" step="0.1">
                <span class="input-group-text">°C</span>
              </div>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Rated kW/TR</td>
            <td><input type="number" name="chiller1_rated_kwtr" class="form-control form-control-sm" step="0.01" min="0"></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Actual kW/TR</td>
            <td><input type="number" name="chiller1_actual_kwtr" class="form-control form-control-sm" step="0.01" min="0"></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">VFD/Non-VFD</td>
            <td>
              <select name="chiller1_vfd_status" class="form-control form-control-sm">
                <option value="">Select</option>
                <option>VFD</option>
                <option>Non-VFD</option>
              </select>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">VFD Modulation %</td>
            <td>
              <div class="input-group input-group-sm">
                <input type="number" name="chiller1_vfd_modulation" class="form-control" min="0" max="100" disabled>
                <span class="input-group-text">%</span>
              </div>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Chiller Plant Manager Automation</td>
            <td>
              <select name="chiller1_automation" class="form-control form-control-sm">
                <option value="">Select</option>
                <option>Yes</option>
                <option>No</option>
              </select>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Refrigerant Type</td>
            <td>
              <select name="chiller1_refrigerant" class="form-control form-control-sm">
                <option value="">Select</option>
                <option>R134a</option>
                <option>R404</option>
                <option>R410a</option>
                <option>Other</option>
              </select>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Avg Top-up per year (kg)</td>
            <td><input type="number" name="chiller1_refrigerant_topup" class="form-control form-control-sm" step="0.1" min="0"></td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">BTU Meter Installed</td>
            <td>
              <select name="chiller1_btu_meter" class="form-control form-control-sm">
                <option value="">Select</option>
                <option>Yes</option>
                <option>No</option>
              </select>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Automated Tube Cleaning System</td>
            <td>
              <select name="chiller1_tube_cleaning" class="form-control form-control-sm">
                <option value="">Select</option>
                <option>Yes</option>
                <option>No</option>
              </select>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Chilled Water Chemical Treatment</td>
            <td>
              <select name="chiller1_chemical_treatment" class="form-control form-control-sm">
                <option value="">Select</option>
                <option>Yes</option>
                <option>No</option>
              </select>
            </td>
            <td class="action-col"></td>
          </tr>
          <tr>
            <td class="fixed-col">Chilled Water Line Insulation Damage</td>
            <td>
              <div class="d-flex gap-2">
                <select name="chiller1_insulation_damage" class="form-control form-control-sm" style="width: 60%;">
                  <option value="">Select</option>
                  <option>Yes</option>
                  <option>No</option>
                </select>
                <input type="number" name="chiller1_insulation_damage_pct" class="form-control form-control-sm" min="0" max="100" placeholder="%" disabled style="width: 40%;">
              </div>
            </td>
            <td class="action-col"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <script>
      let chillerCount = 1;

      function addChillerColumn() {
        chillerCount++;
        const tbody = document.getElementById('chillerTableBody');
        const rows = tbody.rows;
        
        // Update header
        const headerRow = tbody.previousElementSibling.rows[0];
        const newHeader = document.createElement('th');
        newHeader.className = 'chiller-col';
        newHeader.textContent = `Chiller ${chillerCount}`;
        headerRow.insertBefore(newHeader, headerRow.lastElementChild);
        
        // Add cells to each row
        for (let i = 0; i < rows.length; i++) {
          const firstCell = rows[i].cells[1];
          const newCell = firstCell.cloneNode(true);
          
          // Update input names
          const inputs = newCell.getElementsByTagName('input');
          const selects = newCell.getElementsByTagName('select');
          
          for (let input of inputs) {
            input.name = input.name.replace('chiller1_', `chiller${chillerCount}_`);
            input.value = '';
            input.id = input.id ? input.id.replace('chiller1_', `chiller${chillerCount}_`) : '';
            if (input.type === 'checkbox') {
              input.checked = false;
            }
            // Remove any existing datepicker classes and data
            if ($(input).hasClass('hasDatepicker')) {
              $(input).removeClass('hasDatepicker');
              $(input).removeAttr('id');
              $(input).datepicker('destroy');
            }
          }
          
          for (let select of selects) {
            select.name = select.name.replace('chiller1_', `chiller${chillerCount}_`);
            select.id = select.id ? select.id.replace('chiller1_', `chiller${chillerCount}_`) : '';
            select.selectedIndex = 0;
          }
          
          rows[i].insertBefore(newCell, rows[i].lastElementChild);
        }
        
        // Reinitialize year pickers and VFD fields for the new column
        $(document).trigger('columnAdded');
        $('[name^="chiller' + chillerCount + '_vfd_status"]').each(function() {
          updateVFDModulationField(this);
        });
      }

      function removeChillerColumn() {
        if (chillerCount <= 1) return;
        
        const tbody = document.getElementById('chillerTableBody');
        const headerRow = tbody.previousElementSibling.rows[0];
        
        // Remove header
        headerRow.removeChild(headerRow.cells[headerRow.cells.length - 2]);
        
        // Remove cells from each row
        const rows = tbody.rows;
        for (let i = 0; i < rows.length; i++) {
          rows[i].deleteCell(rows[i].cells.length - 2);
        }
        
        chillerCount--;
      }
    </script>
  </div>
</div>

<!-- <div class="form-actions">
  <button type="button" onclick="saveForm()">Save</button>
  <button type="submit" onclick="submitForm()">Submit</button>
</div> -->

<script>
  // Show the first section by default
  window.onload = function() {
    // Initialize all collapsible elements first
    if (typeof initializeCollapsibles === 'function') {
      initializeCollapsibles();
    }
    
    // Show the first section and its first category
    const firstSection = document.querySelector('.section');
    if (firstSection) {
      firstSection.style.display = 'block';
      const firstCategory = firstSection.querySelector('.category-content');
      if (firstCategory) {
        firstCategory.style.display = 'block';
        firstCategory.classList.remove('collapsed');
        const header = firstCategory.previousElementSibling;
        if (header && header.classList.contains('category-header')) {
          header.classList.remove('collapsed');
        }
      }
    }
    
    // Initialize year pickers
    if (typeof initializeYearPickers === 'function') {
      initializeYearPickers();
    }
    
    // Initialize VFD modulation fields
    if (typeof updateVFDModulationField === 'function') {
      $('[name^="chiller"][name$="_vfd_status"]').each(function() {
        updateVFDModulationField(this);
      });
    }
  };

  // Toggle section visibility
  function toggleSection(id) {
    const section = document.getElementById(id);
    if (section) {
      section.style.display = section.style.display === 'none' ? 'block' : 'none';
    }
  }
  
  // Toggle collapsible element
  function toggleCollapsible(header) {
    const isCategory = header.classList.contains('category-header');
    const content = header.nextElementSibling;
    const isCollapsed = header.classList.contains('collapsed');
    
    // Toggle the collapsed state - reversed logic
    if (isCollapsed) {
      header.classList.remove('collapsed');
      if (content) {
        content.style.display = 'block';
        content.classList.remove('collapsed');
      }
    } else {
      header.classList.add('collapsed');
      if (content) {
        content.style.display = 'none';
        content.classList.add('collapsed');
      }
    }
    
    // Handle checkbox state for subcategories - reversed logic
    if (!isCategory) {
      const checkbox = header.querySelector('input[type="checkbox"]');
      if (checkbox) {
        checkbox.checked = isCollapsed; // Changed from !isCollapsed to isCollapsed
      }
    }
  }
  
  // Initialize collapsible elements
  function initializeCollapsibles() {
    // Set up category headers
    const categoryHeaders = document.querySelectorAll('.category-header');
    categoryHeaders.forEach(header => {
      // Initialize state
      header.classList.add('collapsed');
      const content = header.nextElementSibling;
      if (content) {
        content.style.display = 'none';
        content.classList.add('collapsed');
      }
      
      // Add click handler
      header.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleCollapsible(this);
      });
    });
    
    // Set up subcategory headers with checkboxes
    const subcategoryHeaders = document.querySelectorAll('.subcategory-header');
    subcategoryHeaders.forEach(header => {
      const checkbox = header.querySelector('input[type="checkbox"]');
      const content = header.nextElementSibling;
      
      // Initialize state
      header.classList.add('collapsed');
      if (content) {
        content.style.display = 'none';
        content.classList.add('collapsed');
      }
      if (checkbox) {
        checkbox.checked = false;
      }
      
      // Add click handler for header (not checkbox)
      header.addEventListener('click', function(e) {
        if (e.target !== checkbox) {
          e.stopPropagation();
          toggleCollapsible(this);
        }
      });
      
      // Add change handler for checkbox
      if (checkbox) {
        checkbox.addEventListener('change', function(e) {
          e.stopPropagation();
          toggleCollapsible(header);
        });
      }
    });
  }
  
  // Function to expand all sections
  function expandAll() {
    // Show all sections
    document.querySelectorAll('.section').forEach(section => {
      section.style.display = 'block';
    });
    
    // Expand all category headers
    document.querySelectorAll('.category-header').forEach(header => {
      if (header.classList.contains('collapsed')) {
        toggleCollapsible(header);
      }
    });
    
    // Expand all subcategory headers and check their checkboxes
    document.querySelectorAll('.subcategory-header').forEach(header => {
      if (header.classList.contains('collapsed')) {
        toggleCollapsible(header);
      }
      const checkbox = header.querySelector('input[type="checkbox"]');
      if (checkbox && !checkbox.checked) {
        checkbox.checked = true;
      }
    });
  }
  
  // Function to collapse all sections
  function collapseAll() {
    // Hide all sections
    document.querySelectorAll('.section').forEach(section => {
      section.style.display = 'none';
    });
    
    // Collapse every category header
    document.querySelectorAll('.category-header').forEach(header => {
      if (!header.classList.contains('collapsed')) {
        toggleCollapsible(header);
      }
    });
    
    // Collapse all subcategory headers and uncheck their checkboxes
    document.querySelectorAll('.subcategory-header').forEach(header => {
      if (!header.classList.contains('collapsed')) {
        toggleCollapsible(header);
      }
      const checkbox = header.querySelector('input[type="checkbox"]');
      if (checkbox && checkbox.checked) {
        checkbox.checked = false;
      }
    });
  }

  // City data based on state selection
  const cityData = {
    "AP": ["Visakhapatnam", "Vijayawada", "Guntur", "Nellore", "Kurnool"],
    "AR": ["Itanagar", "Naharlagun", "Pasighat", "Namsai"],
    "AS": ["Guwahati", "Silchar", "Dibrugarh", "Jorhat", "Nagaon"],
    "BR": ["Patna", "Gaya", "Muzaffarpur", "Bhagalpur", "Darbhanga"],
    "CG": ["Raipur", "Bhilai", "Bilaspur", "Korba", "Durg"],
    "GA": ["Panaji", "Margao", "Vasco da Gama", "Mapusa", "Ponda"],
    "GJ": ["Ahmedabad", "Surat", "Vadodara", "Rajkot", "Gandhinagar"],
    "HR": ["Gurugram", "Faridabad", "Panipat", "Ambala", "Karnal"],
    "HP": ["Shimla", "Dharamshala", "Solan", "Mandi", "Kullu"],
    "JH": ["Ranchi", "Jamshedpur", "Dhanbad", "Bokaro", "Hazaribagh"],
    "KA": ["Bengaluru", "Mysuru", "Hubli", "Mangaluru", "Belagavi"],
    "KL": ["Thiruvananthapuram", "Kochi", "Kozhikode", "Thrissur", "Kollam"],
    "MP": ["Bhopal", "Indore", "Jabalpur", "Gwalior", "Ujjain"],
    "MH": ["Mumbai", "Pune", "Nagpur", "Thane", "Nashik"],
    "MN": ["Imphal", "Thoubal", "Bishnupur", "Churachandpur"],
    "ML": ["Shillong", "Tura", "Jowai", "Nongstoin", "Williamnagar"],
    "MZ": ["Aizawl", "Lunglei", "Champhai", "Serchhip", "Kolasib"],
    "NL": ["Kohima", "Dimapur", "Mokokchung", "Tuensang", "Wokha"],
    "OR": ["Bhubaneswar", "Cuttack", "Rourkela", "Berhampur", "Sambalpur"],
    "PB": ["Ludhiana", "Amritsar", "Jalandhar", "Patiala", "Bathinda"],
    "RJ": ["Jaipur", "Jodhpur", "Udaipur", "Kota", "Ajmer"],
    "SK": ["Gangtok", "Namchi", "Gyalshing", "Mangan", "Singtam"],
    "TN": ["Chennai", "Coimbatore", "Madurai", "Tiruchirappalli", "Salem"],
    "TG": ["Hyderabad", "Warangal", "Nizamabad", "Karimnagar", "Khammam"],
    "TR": ["Agartala", "Udaipur", "Dharmanagar", "Kailasahar", "Belonia"],
    "UP": ["Lucknow", "Kanpur", "Agra", "Varanasi", "Meerut"],
    "UK": ["Dehradun", "Haridwar", "Roorkee", "Haldwani", "Rudrapur"],
    "WB": ["Kolkata", "Howrah", "Durgapur", "Asansol", "Siliguri"],
    "DL": ["New Delhi", "Delhi", "Dwarka", "Rohini", "Pitampura"]
  };

  // Update city dropdown based on state selection
  document.addEventListener('DOMContentLoaded', function() {
    const stateDropdown = document.getElementById('stateDropdown');
    const cityDropdown = document.getElementById('cityDropdown');
    
    if (stateDropdown && cityDropdown) {
      stateDropdown.addEventListener('change', function() {
        const selectedState = this.value;
        cityDropdown.innerHTML = ''; // Clear existing options
        
        if (!selectedState) {
          const defaultOption = document.createElement('option');
          defaultOption.value = '';
          defaultOption.textContent = 'Please select a state first';
          cityDropdown.appendChild(defaultOption);
          return;
        }
        
        // Add default option
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'Please select';
        cityDropdown.appendChild(defaultOption);
        
        // Add cities for selected state
        const cities = cityData[selectedState] || [];
        cities.forEach(city => {
          const option = document.createElement('option');
          option.value = city;
          option.textContent = city;
          cityDropdown.appendChild(option);
        });
      });
    }
    
    // Toggle input fields based on checkbox selection
    const checkboxes = document.querySelectorAll('.subcategory-header input[type="checkbox"]');
      
    checkboxes.forEach(checkbox => {
      // Find the closest subcategory content
      const header = checkbox.closest('.subcategory-header');
      const subcategoryContent = header ? header.nextElementSibling : null;
      if (!subcategoryContent) {
        // Some headers (e.g., Chiller Details) may not have a dedicated content block
        return;
      }

      const inputGroups = subcategoryContent.querySelectorAll('.input-group');

      // Initialize visibility based on checkbox state
      inputGroups.forEach(group => {
        group.style.display = checkbox.checked ? 'flex' : 'none';
      });

      // Toggle visibility on checkbox change
      checkbox.addEventListener('change', function () {
        inputGroups.forEach(group => {
          group.style.display = this.checked ? 'flex' : 'none';
        });
      });
    });
    
    // Add event listeners for expand/collapse all buttons
    const expandAllBtn = document.getElementById('expandAllBtn');
    const collapseAllBtn = document.getElementById('collapseAllBtn');
    
    if (expandAllBtn) {
      expandAllBtn.addEventListener('click', expandAll);
    }
    
    if (collapseAllBtn) {
      collapseAllBtn.addEventListener('click', collapseAll);
    }
  });

  function saveForm() {
    alert("Form values saved locally (you can implement actual save logic here).");
  }

  function submitForm() {
    // Basic validation for required fields
    const requiredFields = document.querySelectorAll('input[required], select[required]');
    let valid = true;
    
    requiredFields.forEach(field => {
      if (!field.value) {
        field.style.borderColor = '#e32';
        valid = false;
      } else {
        field.style.borderColor = '#ccc';
      }
    });
    
    if (!valid) {
      alert("Please fill in all required fields.");
      return;
    }
    
    alert("Form submitted (you can hook this up to a backend).");
  }

  function addRow(tableId, type) {
    const tbody = document.getElementById(tableId);
    const newRow = tbody.insertRow();
    
    // Clone the first row's cells to maintain the same structure
    const firstRow = tbody.rows[0];
    newRow.innerHTML = firstRow.innerHTML;
    
    // Clear any values in the new row
    const inputs = newRow.getElementsByTagName('input');
    const selects = newRow.getElementsByTagName('select');
    
    for (let input of inputs) {
      if (input.type !== 'button') {
        input.value = '';
      }
    }
    
    for (let select of selects) {
      select.selectedIndex = 0;
    }
    
    // Show the table if it was hidden
    const table = tbody.closest('table');
    if (table) {
      table.style.display = 'table';
    }
  }

  function removeRow(button) {
    const row = button.closest('tr');
    const tbody = row.parentNode;
    const table = tbody.closest('table');
    
    // Don't remove the last row
    if (tbody.rows.length > 1) {
      row.remove();
    } else {
      // Clear the row instead of removing it
      const inputs = row.getElementsByTagName('input');
      const selects = row.getElementsByTagName('select');
      
      for (let input of inputs) {
        if (input.type !== 'button') {
          input.value = '';
        }
      }
      
      for (let select of selects) {
        select.selectedIndex = 0;
      }
      
      // Hide the table if it's empty
      if (table && tbody.rows.length === 1) {
        const inputs = tbody.getElementsByTagName('input');
        let isEmpty = true;
        for (let input of inputs) {
          if (input.type !== 'button' && input.value.trim() !== '') {
            isEmpty = false;
            break;
          }
        }
        if (isEmpty) {
          table.style.display = 'none';
        }
      }
    }
  }
</script>

<script>
// Initialize year pickers
function initializeYearPickers() {
  $('.year-picker').not('.hasYearPicker').addClass('hasYearPicker').datepicker({
    changeMonth: false,
    changeYear: true,
    showButtonPanel: true,
    dateFormat: 'yy',
    yearRange: '1900:2100',
    beforeShow: function(input, inst) {
      setTimeout(function() {
        $(".ui-datepicker-month").hide();
        $(".ui-datepicker-calendar").hide();
        $(".ui-datepicker-close").hide();
      }, 0);
    },
    onClose: function(dateText, inst) {
      const year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
      if (year) {
        $(this).val(year).trigger('change');
      }
    }
  });
}

// Initialize on document ready
$(document).ready(function() {
  // Initialize collapsibles
  if (typeof initializeCollapsibles === 'function') {
    initializeCollapsibles();
  }
  
  // Handle VFD status change
  $(document).on('change', '[name$="_vfd_status"]', function() {
    if (typeof updateVFDModulationField === 'function') {
      updateVFDModulationField(this);
    }
  });
  
  // Initialize year pickers when new columns are added
  $(document).on('columnAdded', function() {
    if (typeof initializeYearPickers === 'function') {
      initializeYearPickers();
    }
    
    // Reinitialize VFD fields for new columns
    if (typeof updateVFDModulationField === 'function') {
      $('[name^="chiller"][name$="_vfd_status"]').each(function() {
        if (!$(this).data('vfd-initialized')) {
          updateVFDModulationField(this);
          $(this).data('vfd-initialized', true);
        }
      });
    }
  });
});

  // Enable/disable VFD modulation field based on VFD status
  function updateVFDModulationField(select) {
    const vfdModulationInput = $(select).closest('tr').next().find('input[type="number"]');
    const isVFD = $(select).val() === 'VFD';
    vfdModulationInput.prop('disabled', !isVFD);
    if (!isVFD) {
      vfdModulationInput.val('');
    }
  }

  // Initialize VFD modulation fields on page load
  $('[name^="chiller"][name$="_vfd_status"]').each(function() {
    updateVFDModulationField(this);
  });

  // Handle VFD status changes
  $(document).on('change', '[name^="chiller"][name$="_vfd_status"]', function() {
    updateVFDModulationField(this);
  });

  // Enable/disable insulation damage percentage
  $(document).on('change', '[name^="chiller"][name$="_insulation_damage"]', function() {
    const damagePercentInput = $(this).closest('td').find('input[type="number"]');
    const hasDamage = $(this).val() === 'Yes';
    damagePercentInput.prop('disabled', !hasDamage);
    if (!hasDamage) {
      damagePercentInput.val('');
    }
  });
});
</script>
</body>
</html>
